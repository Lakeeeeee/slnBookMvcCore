@inject UserInforService _userInforService

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - prjBookMvcCore</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/prjBookMvcCore.styles.css" asp-append-version="true" />
    <style>
        div {
            /*border: 1px solid #ff0000*/
        }

        .zero {
            margin: 0;
            padding: 0;
        }

        .menu ul li { /*li水平顯示*/
            display: inline;
        }

        /*浮動優惠*/
        .popup-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgb(250, 240, 230);
            padding: 20px;
            border: 2px dashed rgb(150, 25, 200);
            border-radius: 25px 0;
            display: none;
            z-index: 9999;
        }

            .popup-container.show-popup {
                display: block;
            }

        #floating-button {
            position: fixed;
            bottom: 20%;
            left: 8%;
            transform: translate(0, -50%);
        }
    </style>
</head>
<body>
    @*浮動優惠*@
    <div id="floating-button">
        <button class="btn btn-danger " onclick="showPopup()">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-gift" viewBox="0 0 16 16">
                <path d="M3 2.5a2.5 2.5 0 0 1 5 0 2.5 2.5 0 0 1 5 0v.006c0 .07 0 .27-.038.494H15a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 14.5V7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h2.038A2.968 2.968 0 0 1 3 2.506V2.5zm1.068.5H7v-.5a1.5 1.5 0 1 0-3 0c0 .085.002.274.045.43a.522.522 0 0 0 .023.07zM9 3h2.932a.56.56 0 0 0 .023-.07c.043-.156.045-.345.045-.43a1.5 1.5 0 0 0-3 0V3zM1 4v2h6V4H1zm8 0v2h6V4H9zm5 3H9v8h4.5a.5.5 0 0 0 .5-.5V7zm-7 8V7H2v7.5a.5.5 0 0 0 .5.5H7z" />
            </svg>
        </button>
        <span class="translate-middle badge rounded-pill bg-secondary" id="timer"></span>
    </div>
    <form asp-action="Promotions限時登入領取優惠" id="takecoupon_form" asp-controller="Promotions">
        <div id="popup" class="popup-container">
            <h2>領取優惠券</h2>
            <p style="text-align:center">滿999扣77元</p>
            <button id="close" class="position-absolute top-0 start-100 translate-middle  rounded-pill  btn-outline-dark">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-octagon-fill" viewBox="0 0 16 16">
                    <path d="M11.46.146A.5.5 0 0 0 11.107 0H4.893a.5.5 0 0 0-.353.146L.146 4.54A.5.5 0 0 0 0 4.893v6.214a.5.5 0 0 0 .146.353l4.394 4.394a.5.5 0 0 0 .353.146h6.214a.5.5 0 0 0 .353-.146l4.394-4.394a.5.5 0 0 0 .146-.353V4.893a.5.5 0 0 0-.146-.353L11.46.146zm-6.106 4.5L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708z" />
                </svg>
            </button>
            <button class="btn btn-outline-info" id="takecoupon" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-ticket-perforated-fill" viewBox="0 0 16 16">
                    <path d="M0 4.5A1.5 1.5 0 0 1 1.5 3h13A1.5 1.5 0 0 1 16 4.5V6a.5.5 0 0 1-.5.5 1.5 1.5 0 0 0 0 3 .5.5 0 0 1 .5.5v1.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 11.5V10a.5.5 0 0 1 .5-.5 1.5 1.5 0 1 0 0-3A.5.5 0 0 1 0 6V4.5Zm4-1v1h1v-1H4Zm1 3v-1H4v1h1Zm7 0v-1h-1v1h1Zm-1-2h1v-1h-1v1Zm-6 3H4v1h1v-1Zm7 1v-1h-1v1h1Zm-7 1H4v1h1v-1Zm7 1v-1h-1v1h1Zm-8 1v1h1v-1H4Zm7 1h1v-1h-1v1Z" />
                </svg>
                現在領取優惠券，立即享受折扣優惠！
            </button>
        </div>
    </form>
    <script>
        var timeInSeconds = 3600 - 1;
        window.addEventListener('DOMContentLoaded', function () {
            showPopup();

            var close隱藏浮動視窗 = document.querySelector('#close');
            close隱藏浮動視窗.addEventListener('click', function (event) {
                event.preventDefault();
                hidePopup();
            });
        });

        function showPopup() {
            var popup = document.getElementById("popup");
            popup.classList.add("show-popup");
            //var timerElement = document.getElementById("timer");
            //var timer = setInterval(function () {
            //    var minutes = Math.floor((timeInSeconds % 3600) / 60);
            //    var seconds = timeInSeconds % 60;
            //    timerElement.textContent = `${padZero(minutes)}:${padZero(seconds)}`;
            //    timeInSeconds--;
            //    if (timeInSeconds < 0) { clearInterval(timer); hidePopup(); }
            //}, 999);
        }

        function hidePopup() {
            var popup = document.getElementById("popup");
            popup.classList.remove("show-popup");
        }

        function padZero(num) { return num.toString().padStart(2, '0'); }
    </script>
    <script>

        const countdownEl = document.getElementById("timer");

        let remainingTime = getRemainingTime();
        let countdownId = null;

        function getRemainingTime() {
            const startTime = sessionStorage.getItem("countdownStartTime");
            if (startTime) {
                const currentTime = Math.floor(Date.now() / 1000);
                const elapsedTime = currentTime - startTime;
                const initialTime = 60 * 60; // 60 minutes
                return Math.max(initialTime - elapsedTime, 0);
            }
            return 0;
        }

        function saveStartTime() {
            const startTime = Math.floor(Date.now() / 1000);
            sessionStorage.setItem("countdownStartTime", startTime);
        }

        function showRemainingTime() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            countdownEl.innerText = `${minutes} : ${seconds} `;

            if (remainingTime === 0) {
                clearInterval(countdownId);
                hidePopup();
            }

            remainingTime--;
        }

        function startCountdown() {
            saveStartTime();
            countdownId = setInterval(showRemainingTime, 1000);
        }

        startCountdown();

    </script>
    <script>
        const coupon = document.querySelector('#takecoupon_form');
        coupon.addEventListener('submit', async (event) => {
            event.preventDefault();
            const response = await fetch('@Url.ActionLink("Promotions限時登入領取優惠")', {
                method: 'POST'
            });
            const confirmtext = await response.text();
            if (confirmtext === "exist") {
                alert('已領取');
                hidePopup();
            }
            if (confirmtext === "notexist") {
                alert('領取成功，系統將自動轉向會員中心');
                window.location.href = '@Url.Action("MemberCenter", "Member")';
            }
        });
    </script>

    <div style="background-image:url('');background-size:100%;">
        @*導覽開始*@
        <nav class="navbar navbar-expand-sm navbar-light bg-light border-bottom navbar-toggleable-sm  box-shadow mb-3 ">
            <div class="container">
                @*LOGO開始*@
                <div class="align-items-start">
                    @Html.ActionLink("讀本", "Home", "Home", new { area = "" }, new { @class = "navbar-brand" })  @*須換圖*@
                </div>
                @*登入選項開始*@
                <div class="justify-content-end menu">
                    <ul class="zero">
                        @{
                            if (_userInforService.UserId != 0)
                            {
                                <li> Hi! @_userInforService.UserName </li>
                                <li><a role="button" class="btn btn-sm btn-outline-secondary mx-1" href="~/Member/LogOut">登出</a></li>
                            }
                            else
                            {
                                <li><a role="button" class="btn btn-sm btn-outline-secondary mx-1" href="~/Member/Login">登入</a></li>
                                <li><a role="button" class="btn btn-sm btn-outline-secondary mx-1" href="~/Member/Signin">註冊</a></li>
                            }
                        }
                        <li><a role="button" class="btn btn-sm btn-outline-secondary mx-1" href="~/Member/MemberCenter">會員中心</a></li>
                        <li><a role="button" class="btn btn-sm btn-outline-secondary mx-1" href="~/Order/ShoppingCart"><img src="~/Image/shoppingCartIcon20px.png" style="width:20" /></a></li>
                    </ul>
                </div>
            </div>
        </nav>
        @*導覽結束*@
        @*分類 & 搜尋開始*@
        <div class="navbar navbar-default navbar-fixed-top" style="">
            <div class="navbar navbar-light bg-light container" style="border:1px solid #000000; background-color:#ebf8bc">
                @*分類*@
                <form class="justify-content-start">
                    <div class="menu">
                        <ul class="zero">
                            <li><a role="button" class="btn btn-sm btn-outline-success mx-1" href="~/Home/Menu">書籍</a></li>
                            <li><a role="button" class="btn btn-sm btn-outline-secondary mx-1" href="~/Promotions/Promotions活動總覽圖">活動文宣</a></li>
                        </ul>
                    </div>
                </form>
                @*搜尋*@
                <form class="justify-content-end">
                    <div class="input-group navbar navbar-light bg-light menu">
                        <input id="search_input" style="border-right: #C4C4C4 2px solid;" placeholder="搜尋" type="search" class="mx-1 form-control inputForSearch ui-autocomplete-input" maxlength="40" value="" autocomplete="off">
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-success mx-1 dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                進階搜尋
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" style="width:500px">
                                <li>
                                    <div class="m-1 p-1">
                                        <span class="mx-2">搜尋欄位</span>
                                        <button class="btn btn-sm btn-outline-success mx-1 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            全文
                                        </button>
                                    </div>
                                </li>
                                <li>
                                    <div class="m-1 p-1">
                                        <span class="mx-2">商品類型</span>
                                        <button class="btn btn-sm btn-outline-success mx-1 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            選擇類型
                                        </button>
                                    </div>
                                </li>
                                <li>
                                    <div class="m-1 p-1">
                                        <span class="mx-2">售價</span>
                                        <input style="border-right: #C4C4C4 2px solid;width:100px" placeholder="金額" type="search" maxlength="20" value="" autocomplete="off" />
                                        <span class="mx-2">至</span>
                                        <input style="border-right: #C4C4C4 2px solid;width:100px" placeholder="金額" type="search" maxlength="20" value="" autocomplete="off" />
                                        <span class="mx-2">之間</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="m-1 p-1">
                                        <span class="mx-2">折扣</span>
                                        <button class="btn btn-sm btn-outline-success mx-1 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            請選擇
                                        </button>
                                        <span class="mx-2">至</span>
                                        <button class="btn btn-sm btn-outline-success mx-1 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            請選擇
                                        </button>
                                        <span class="mx-2">之間</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="m-1 p-1">
                                        <span class="mx-2">出版日期</span>
                                        <input style="border-right: #C4C4C4 2px solid;width:100px" placeholder="日期" type="search" maxlength="20" value="" autocomplete="off" />
                                        <span class="mx-2">至</span>
                                        <input style="border-right: #C4C4C4 2px solid;width:100px" placeholder="日期" type="search" maxlength="20" value="" autocomplete="off" />
                                        <span class="mx-2">之間</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <button class="btn btn-sm btn-outline-success mx-1">搜尋</button>
                    </div>
                </form>
            </div>
        </div>
        @*分類 & 搜尋結束*@

    </div>
    <br />
    <div class="container body-content">
        @* body *@
        @RenderBody()
    </div>

    <div class="container body-content">
        @* buttom *@
        <br /><hr />
        <div class="container">
            <div class="row">
                <div class="col" style="text-align:center">
                    <img src="~/Image/AD.png" alt="活動or優惠or廣告" width="100%" />
                    廣告招商中
                </div>
                <div class="col" style="text-align:center">
                    <img src="~/Image/AD.png" alt="活動or優惠or廣告" width="100%" />
                    廣告招商中
                </div>
                <div class="col" style="text-align:center">
                    <img src="~/Image/AD.png" alt="活動or優惠or廣告" width="100%" />
                    廣告招商中
                </div>
            </div>
        </div>

        <br />
        <hr />
        <div>
            <span style="margin-right:10px"><a href="#id">客服專區</a></span>
            <span style="margin-right:10px"><a href="~/Home/QA">客服專區</a></span>
        </div>
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - My ASP.NET Application</p>
        </footer>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
