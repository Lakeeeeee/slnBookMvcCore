
@{
    ViewData["Title"] = "Promotions註冊會員禮";
}

<!DOCTYPE html>
<html>
<head>
    <style>
        .popup-container {
            position: fixed;
            top: 50%;
            right: -300px;
            transform: translate(0, -50%);
            width: 300px;
            background-color: #f2f2f2;
            padding: 20px;
            transition: right 0.3s;
            z-index: 9999;
        }

        .show-popup {
            right: 0;
        }

        .countdown {
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
    </style>

</head>
<body>
    <div style="border:1px dashed rgb(200, 150, 250)">
        <form asp-action="Promotions限時登入領取優惠" id="takecoupon_form">
        測試區塊
        <div id="popup" class="popup-container">
            <h2>領取優惠券</h2>
                <p><a href="~/Promotions/Promotions限時登入領取優惠" role="button" id="takecoupon" type="submit">現在領取優惠券，立即享受折扣優惠！</a></p>
               
            <p class="countdown" id="countdown">倒數計時: <span id="timer">5</span> 秒</p>
            <button onclick="hidePopup()">關閉</button>
        </div>
        </form>
    </div>
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
    <li class="breadcrumb-item"><a class="text-decoration-none" href="~/Home/Home" style="color:black">首頁</a></li>
            <li class="breadcrumb-item"><a class="text-decoration-none" href="~/Promotions/Promotions活動總覽圖" style="color:black">活動</a></li>
            <li class="breadcrumb-item active" aria-current="page" style="color:gray">註冊會員禮</li>
    </ol>
</nav>
    <div>
        <img src="~/Image/Promotions/註冊會員_上.png" class="d-block w-100" alt="page1" width="80%">
    </div>
    <div class="d-block w-100" style="background-image: url('/Image/Promotions/註冊會員_下.png'); background-size: cover; padding:50px;border:unset ;text-align:center">
        <a role="button" class="btn btn-outline-info fs-2" href="~/Member/Signin" style="font-size:large">立即加入會員!!</a>
    </div>

<script>
    window.addEventListener('DOMContentLoaded', function () {
        showPopup();
    });

    function showPopup() {
        var popup = document.getElementById("popup");
        var countdown = document.getElementById("countdown");
        popup.classList.add("show-popup");

        var seconds = 5;
        countdown.innerHTML = "倒數計時: <span id='timer'>" + seconds + "</span> 秒";

        var timer = setInterval(function () {
            seconds--;
            countdown.innerHTML = "倒數計時: <span id='timer'>" + seconds + "</span> 秒";

            if (seconds <= 0) {
                clearInterval(timer);
                hidePopup();
            }
        }, 1000);
    }

    function hidePopup() {
        var popup = document.getElementById("popup");
        popup.classList.remove("show-popup");
    }
</script>
<script>
    const coupon = document.querySelector('#takecoupon_form');
    coupon.addEventListener('submit', async (event) => {
        event.preventDefault();
        const response = await fetch('@Url.ActionLink("Promotions限時登入領取優惠")', {
            method: 'POST',
            body: new FormData(coupon)
        });
        const confirmtext = await response.text();
        if (confirmtext === "exist") {
            alert('已領取');
        }
        if (confirmtext === "notexist") {
            alert('領取成功，系統將自動轉向會員中心');
            window.location.href = '@Url.Action("MemberCenter", "Member")'; 
    });
</script>

</body>
</html>
